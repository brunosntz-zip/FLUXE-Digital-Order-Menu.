{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ produto.nome }} - Detalhes</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/tela-inicial-cardapio.css' %}">
  <link rel="stylesheet" href="{% static 'css/detalhes.css' %}">
</head>
<body>
  <div class="app">
    <div class="topbar">
      <a href="{% url 'home' %}" class="iconbtn" aria-label="Voltar" style="text-decoration:none; display:flex; align-items:center; justify-content:center;">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </a>
      <h3>Detalhes</h3>
      <div style="width:42px"></div> 
    </div>

    <div class="product-detail">
      <img class="product-image" 
           src="{{ produto.foto_url }}" 
           alt="{{ produto.nome }}"
           onerror="this.src='{% static 'imagens/xequemate.webp' %}'">

      <div class="product-info">
        <small class="muted">{{ produto.categoria.nome|default:"Geral" }}</small>
        
        <h2>{{ produto.nome }}</h2>
        
        <span class="price" id="preco-topo">R$ {{ produto.preco_atual }}</span>

        <h4>Descrição</h4>
        <p class="desc">
          {{ produto.descricao|default:"Sem descrição definida."|linebreaksbr }}
        </p>

        <form action="{% url 'add_carrinho' produto.id %}" method="POST" style="margin-top: 20px;">
            {% csrf_token %} 
            
            <div class="quantity-area">
              <button type="button" class="qty-btn" id="btn-menos" aria-label="Diminuir">−</button>
              <span id="qty-display">1</span>
              <button type="button" class="qty-btn" id="btn-mais" aria-label="Aumentar">+</button>
              
              <input type="hidden" name="quantidade" id="input-qty" value="1">
            </div>

            <button type="submit" class="add-cart-btn" id="btn-adicionar">
                Adicionar • <span id="btn-total">R$ {{ produto.preco_atual }}</span>
            </button>
        </form>

      </div>
    </div>
  </div>

 <script>
  document.addEventListener("DOMContentLoaded", () => {
      
      // 1. Pega o preço cru do Django (ex: 20.99 ou 20,99) e transforma em número JS
      // O .replace(',', '.') garante que funciona mesmo se o Django mandar vírgula
      const rawPrice = "{{ produto.preco_atual }}".replace(',', '.');
      const precoUnitario = parseFloat(rawPrice);
      
      // Elementos
      const qtySpan = document.getElementById('qty-display');
      const inputQty = document.getElementById('input-qty');
      const btnTotal = document.getElementById('btn-total');
      const precoTopo = document.getElementById('preco-topo'); // Preço lá de cima
      const btnMenos = document.getElementById('btn-menos');
      const btnMais = document.getElementById('btn-mais');

      let quantidade = 1;

      // 2. Função de Formatação Brasil (R$ 20,00)
      function formatarMoeda(valor) {
          return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
      }

      // 3. Atualiza os valores na tela
      function atualizarValores() {
          const total = precoUnitario * quantidade;
          // Atualiza o botão lá embaixo
          btnTotal.textContent = formatarMoeda(total);
          // Atualiza o preço unitário lá em cima (pra garantir a vírgula)
          if(precoTopo) precoTopo.textContent = formatarMoeda(precoUnitario);
      }

      // Eventos dos botões + e -
      btnMais.addEventListener('click', () => {
        quantidade++;
        qtySpan.textContent = quantidade;
        inputQty.value = quantidade;
        atualizarValores();
      });

      btnMenos.addEventListener('click', () => {
        if (quantidade > 1) {
          quantidade--;
          qtySpan.textContent = quantidade;
          inputQty.value = quantidade;
          atualizarValores();
        }
      });
      
      // Roda uma vez ao carregar pra arrumar a formatação inicial
      atualizarValores();
  });
</script>
</body>
</html>